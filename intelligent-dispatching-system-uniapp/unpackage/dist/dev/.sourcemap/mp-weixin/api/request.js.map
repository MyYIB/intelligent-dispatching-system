{"version":3,"file":"request.js","sources":["api/request.js"],"sourcesContent":["// 基础URL\r\nconst BASE_URL = 'http://localhost:8081';\r\n\r\n// 封装请求方法\r\nexport const request = (url, method, data) => {\r\n  return new Promise((resolve, reject) => {\r\n    const token = uni.getStorageSync('token');\r\n    \r\n    uni.request({\r\n      url: `${BASE_URL}${url}`,\r\n      method,\r\n      data,\r\n      header: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': token ? `Bearer ${token}` : ''\r\n      },\r\n      success: (res) => {\r\n        console.log(res);\r\n        if (res.statusCode === 401) {\r\n          // 未授权，清除token并跳转到登录页\r\n          uni.removeStorageSync('token');\r\n          uni.removeStorageSync('userInfo');\r\n          uni.showToast({\r\n            title: '登录已过期，请重新登录',\r\n            icon: 'none'\r\n          });\r\n          \r\n          // 使用navigateTo替代reLaunch，避免超时问题\r\n          setTimeout(() => {\r\n            uni.navigateTo({\r\n              url: '/pages/login/Login',\r\n              fail: (err) => {\r\n                console.error('跳转登录页失败:', err);\r\n                // 如果跳转失败，尝试使用switchTab\r\n                uni.switchTab({\r\n                  url: '/pages/index'\r\n                });\r\n              }\r\n            });\r\n          }, 1500);\r\n          reject(new Error('未授权'));\r\n        } else {\r\n          resolve(res.data);\r\n        }\r\n      },\r\n      fail: (err) => {\r\n        reject(err);\r\n      }\r\n    });\r\n  });\r\n};"],"names":["uni"],"mappings":";;AACA,MAAM,WAAW;AAGL,MAAC,UAAU,CAAC,KAAK,QAAQ,SAAS;AAC5C,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtC,UAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AAExCA,kBAAAA,MAAI,QAAQ;AAAA,MACV,KAAK,GAAG,QAAQ,GAAG,GAAG;AAAA,MACtB;AAAA,MACA;AAAA,MACA,QAAQ;AAAA,QACN,gBAAgB;AAAA,QAChB,iBAAiB,QAAQ,UAAU,KAAK,KAAK;AAAA,MAC9C;AAAA,MACD,SAAS,CAAC,QAAQ;AAChBA,sBAAAA,MAAA,MAAA,OAAA,wBAAY,GAAG;AACf,YAAI,IAAI,eAAe,KAAK;AAE1BA,8BAAI,kBAAkB,OAAO;AAC7BA,8BAAI,kBAAkB,UAAU;AAChCA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UAClB,CAAW;AAGD,qBAAW,MAAM;AACfA,0BAAAA,MAAI,WAAW;AAAA,cACb,KAAK;AAAA,cACL,MAAM,CAAC,QAAQ;AACbA,8BAAA,MAAA,MAAA,SAAA,wBAAc,YAAY,GAAG;AAE7BA,8BAAAA,MAAI,UAAU;AAAA,kBACZ,KAAK;AAAA,gBACvB,CAAiB;AAAA,cACF;AAAA,YACf,CAAa;AAAA,UACF,GAAE,IAAI;AACP,iBAAO,IAAI,MAAM,KAAK,CAAC;AAAA,QACjC,OAAe;AACL,kBAAQ,IAAI,IAAI;AAAA,QACjB;AAAA,MACF;AAAA,MACD,MAAM,CAAC,QAAQ;AACb,eAAO,GAAG;AAAA,MACX;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;;"}